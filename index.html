<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>メトロノームの実験</title>
<meta name="description" content="">
<meta name="keywords" content="">

<link href="./css/styles.css" rel="stylesheet" type="text/css" media="all">
<link href="./css/bootstrap.css" rel="stylesheet" type="text/css" media="all">
<link rel="shortcut icon" href="./images/favicon.ico"> 

<!-- jQuery library (served from Google) -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
<script src="./js/Chart.js" type="text/javascript"></script>
<script src="./js/utils.js" type="text/javascript"></script>
<script src="./js/bootstrap.js" type="text/javascript"></script>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

 <style>
    canvas{
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
	
	.wrapper {
		width : 600px ;
		position : reltive ;
		top : 20% ;
		background : #efefef ;
		border : 1px #ccc solid ;
		padding : 10px ;
		margin : 0 auto ;
	}
	
	.tempo {
		padding : 5px ;
		font-size : 28px ;
		font-weight : bold ;
		background : #ccc ;
		width : 130px ;
		text-align: right ;
	}
	
	.player li {
		font-size : 30px ;
		cursor: pointer ;
	}
	
	.player li:last-child {
		font-size : 30px ;
	}
	
	.flash {
		position : relative ;
		left : -10px ;
		top : -3px ;
		display: none ;
		margin-bottom : -20px ;
	}
	
	.i_block li.stop {
		display : none ;
	}
	
	.speed_ctrl ul {
		text-align : center ;
	}
	
	.speed_ctrl li {
		padding : 5px ;
		margin : 5px ;
		background : #333 ;
		color : #fff ;
		cursor : pointer ;
	}
	
    </style>		
</head>
<body>

<h1 class="center">Metronome</h1>


<div class="wrapper">
	
	<div class="cf">
		<div class="tempo left">120</div>
		<p class="flash">●</p>
		
		<div class="right speed_ctrl">
			<ul class="i_block">
				<li class="tempo-1"><</li>
				<li class="tempo+1">></li>
			</ul>
			<ul class="i_block">
				<li class="tempo-5">-5</li>
				<li class="tempo+5">+5</li>
			</ul>
		</div>
	</div>
	
	<div class="player">
		<ul class="i_block">
			<li class="play">▶</li>
			<li class="stop">■</li>
		</ul>
	</div>
	
	<div class="signature">
		<p>拍子</p>
		<p>4/4</p>
	</div>
	
	<div class="prog">		
		<dl>
			<dt>テンポ変化</dt>
			<dd><label><input type="checkbox">ON</label></dd>
		</dl>
		
		<input type="text">～<input type="text">
		
		<input type="text">min
		
		かけて変化
		
		<dl>
			<dt>サイレント</dt>
			<dd><label><input type="checkbox">ON</label></dd>
		</dl>
		
		<input type="text">小節ごとに<input type="text">消音
		
	</div>
	

</div>



<script>
var tempo = 120; //テンポ（1分間に何拍するか）
var beat  = 4; //拍子（指定した拍数ごとに高いビープ音を鳴らす）
isPlaying = false;

function metronome(tempo, beat){
	// 低め音
	var low = "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";

	// 高めの音
	var high = "UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQ0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

	// それぞれ Audio オブジェクト生成
	var lowPlayer = new Audio("data:audio/wav;base64," + low);
	var highPlayer = new Audio("data:audio/wav;base64," + high);
	
	function playOn() {
		console.log("ok");
		lowPlayer.play();
		$('.flash').show();
		$('.flash').fadeOut();
	}

	// メトロノーム設定（正確にはひとつのInterval内で処理を書いたほうがよいが簡略化のためにふたつのIntervalで設定）
	// low の再生　拍子内の1拍目はミュートする
	timer1 = setInterval(playOn, 500);
	
	// high の再生　拍子内の1拍目のみ慣らす
	/*
	setInterval(function(){
		highPlayer.play();
		}, 60 / tempo * 1000 * beat);
	*/
}

// 再生ボタンを押してメトロノームをスタート    
$('.play').click(function(){
	if ( !isPlaying ) {
		isPlaying = true;
		$('.play').hide();
		$('.stop').show();
		metronome(beat, tempo);
	}
});

// 停止
$('.stop').click(function(){
	$('.stop').hide();
	$('.play').show();
	isPlaying = false;
	clearInterval(timer1);	
});

// 速度が変更されたとき
$('.tempo+1').click(function(){

});

$('.tempo-1').click(function(){

});


</script>


</body>
</html>