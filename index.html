<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>メトロノーム</title>
<meta name="description" content="">
<meta name="keywords" content="">

<link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">

<link href="./css/bootstrap.css" rel="stylesheet" type="text/css" media="all">
<link href="./css/common.css" rel="stylesheet" type="text/css" media="all">
<link href="./css/styles.css" rel="stylesheet" type="text/css" media="all">
<link rel="shortcut icon" href="./images/favicon.ico"> 

<!-- jQuery library (served from Google) -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
<script src="./js/utils.js" type="text/javascript"></script>
<script src="./js/bootstrap.js" type="text/javascript"></script>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
	
</head>
<body>

<div class="wrapper">

	<div class="left_side">
		<!--<p class="flash">●</p>-->
		<div class="anime1">
			<p class="frame0"><img src="./images/crossing0.png"></p>
			<p class="frame1"><img src="./images/crossing1.png"></p>
			<p class="frame2"><img src="./images/crossing2.png"></p>
		</div>
	</div>
	
	<div class="right_side">	
	
		<div class="right_side_wrapper">
	
			<h1 class="center logo">Prg Metronome</h1>
		
			<div class="display">
				<div class="tempo">120</div>
			</div>
			
			<div class="time_signature">
				<p class="center">4/4</p>
			</div>	
			
			<div class="flex_list ctrl_panel">
				<div class="player">
					<ul class="flex_list">
						<li class="play"><i class="fa fa-play" aria-hidden="true"></i></li>
						<li class="stop"><i class="fa fa-stop" aria-hidden="true"></i></li>
					</ul>
				</div>
				
				<div class="speed_ctrl">
					<ul class="flex_list">
						<li class="tempo1_down"><</li>
						<li class="tempo1_up">></li>
					</ul>
					<ul class="flex_list">
						<li class="tempo5_down">-5</li>
						<li class="tempo5_up">+5</li>
					</ul>
				</div>
			</div>
			
			<div class="prog center">		
				
				<p class="training_trigger">Training mode</p>
				<div class="training">			
					<input type="text">～<input type="text">
					
					<input type="text">bars
				</div>
		
				<p class="silent_trigger">Silent mode</p>
				<div class="silent">		
					<input type="text">bar<input type="text">
				</div>
		
			</div>
		
		</div>		
	
	</div>

</div>

<script>
var tempo = 120; //テンポ（1分間に何拍するか）
var beat  = 4; //拍子（指定した拍数ごとに高いビープ音を鳴らす）
var frame_cnt = 0;
isPlaying = false;

// 低め音
var low = "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";

// 高めの音
var high = "UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQ0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";


function metronome(tempo, beat){

	// それぞれ Audio オブジェクト生成
	var lowPlayer = new Audio("data:audio/wav;base64," + low);
	var highPlayer = new Audio("data:audio/wav;base64," + high);
	
	function playOn() {
		lowPlayer.play();
		frame_cnt = frame_cnt + 1;
		console.log(frame_cnt);
		
		$('.anime1 .frame0').hide();
		
		if( frame_cnt % 2 == 0 ) {
			console.log("even");
			$('.anime1 .frame1').hide();
			$('.anime1 .frame2').show();
		} else {
			console.log("odd");
			$('.anime1 .frame2').hide();
			$('.anime1 .frame1').show();
		}
		
		//$('.flash').show();
		//$('.flash').fadeOut(180);
	}

	ms = ( 60 / tempo ) * 1000;

	// 最初の1音
	playOn();

	// メトロノーム設定（正確にはひとつのInterval内で処理を書いたほうがよいが簡略化のためにふたつのIntervalで設定）
	// low の再生　拍子内の1拍目はミュートする
	timer1 = setInterval(playOn, ms);
	
	// high の再生　拍子内の1拍目のみ慣らす
	/*
	setInterval(function(){
		highPlayer.play();
		}, 60 / tempo * 1000 * beat);
	*/
}

/*-----------------------------------------------
// 再生ボタンを押してメトロノームをスタート    
-------------------------------------------------*/
$('.play').click(function(){
	if ( !isPlaying ) {
		isPlaying = true;
		$('.play').hide();
		$('.stop').show();
		metronome(tempo, beat);
	}
});

/*-----------------------------------------------
// 停止処理   
-------------------------------------------------*/
$('.stop').click(function(){
	$('.stop').hide();
	$('.play').show();
	isPlaying = false;
	clearInterval(timer1);
	$('.anime1 .frame1').hide();
	$('.anime1 .frame2').hide();
	$('.anime1 .frame0').show();
});

/*-----------------------------------------------
// 速度変更    
-------------------------------------------------*/
$('.tempo1_up').click(function(){
	tempo = tempo + 1;
	$('.tempo').text(tempo); 
});

$('.tempo1_down').click(function(){
	tempo = tempo - 1;
	$('.tempo').text(tempo); 
});

$('.tempo5_up').click(function(){
	tempo = tempo + 5;
	$('.tempo').text(tempo); 
});

$('.tempo5_down').click(function(){
	tempo = tempo - 5;
	$('.tempo').text(tempo); 
});


</script>


</body>
</html>